{% extends "base.html" %}
{% block title %}Create Trip{% endblock %}
{% block content %}
<h1>Create a New Trip</h1>
<form method="POST" action="{{ url_for('create_trip') }}">
    {{ form.hidden_tag() }}
	<div>
        {{ form.country.label }}
        {{ form.country(size=32, list="countryList", id="countryInput") }}
		{% for error in form.country.errors %}
            <span style="color: red;">{{ error }}</span>
        {% endfor %}
		<datalist id="countryList"></datalist>
    </div>
    <div>
        {{ form.city.label }}
        {{ form.city(size=32, list="cityList", id="cityInput", disabled='disabled') }}
		{% for error in form.city.errors %}
            <span style="color: red;">{{ error }}</span>
        {% endfor %}
		<datalist id="cityList"></datalist>
    </div>
    <div>
        {{ form.start_date.label }}
        {{ form.start_date() }}
		{% for error in form.start_date.errors %}
            <span style="color: red;">{{ error }}</span>
        {% endfor %}
    </div>
    <div>
        {{ form.end_date.label }}
        {{ form.end_date() }}
		{% for error in form.end_date.errors %}
            <span style="color: red;">{{ error }}</span>
        {% endfor %}
    </div>
	<div>
        {{ form.comments.label }}
        {{ form.comments(rows=10, cols=40, class_="form-control") }}
	</div>
    <div>
        {{ form.submit() }}
    </div>
</form>

<script>
	function checkCityAvailability() {
		const countryValue = document.getElementById('countryInput').value;
		const cityInput = document.getElementById('cityInput');
		if (countryValue !== '') {
			cityInput.disabled = false;
			cityInput.value = '';
			cityInput.classList.remove('disabled');
			const cityList = document.getElementById('cityList');
			fetch('/static/json/cities.json')
				.then(response => response.json())
				.then(data => {
				data[countryInput.value].forEach(country => {
					const listItem = document.createElement('option');
					listItem.value = country;
					cityList.appendChild(listItem);
			})});
		} else {
			cityList.innerHTML = "";
			cityInput.disabled = true;
			cityInput.classList.add('disabled');
		}
	}
	
	const countryList = document.getElementById('countryList');
	fetch('/static/json/countries.json')
		.then(response => response.json())
		.then(data => {
	// Split the string into an array of countries
		data.forEach(country => {
			const listItem = document.createElement('option');
			listItem.value = country;
			countryList.appendChild(listItem);
		})});
		
	const countryInput = document.getElementById('countryInput');
	const cityInput = document.getElementById('cityInput');
	
	document.getElementById('countryInput').addEventListener('input', function() {
		checkCityAvailability();
	});
	
	window.onload = checkCityAvailability();
</script>

{% endblock %}
